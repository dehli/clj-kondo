name: Release sync

on: 
  workflow_dispatch: ~
  schedule:
    # Every sunday 12:00 UTC, 05:00 PDT
    - cron:  '0 12 * * 0'

jobs:
  release-sync:
    runs-on: ubuntu-latest
    steps:
    # From https://stackoverflow.com/a/61919791
    - id: get_release
      run: | 
        content=`curl --silent "https://api.github.com/repos/clj-kondo/clj-kondo/releases/latest"`
        # the following lines are only required for multi line json
        content="${content//'%'/'%25'}"
        content="${content//$'\n'/'%0A'}"
        content="${content//$'\r'/'%0D'}"
        # end of optional handling for multi line json
        echo "::set-output name=releaseJson::$content"
    - run: echo "${{fromJson(steps.get_release.outputs.releaseJson).version}}"